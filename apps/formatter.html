<!-- =============================================
FILE: features/formatter.html  (single-file page)
Put this anywhere in your repo and link to it from your home page nav.
Requires a Netlify function at /.netlify/functions/call-gemini (see below).
============================================= -->
<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Text Formatter ‚Ä¢ MediaDash</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800">
  <header class="sticky top-0 z-30 bg-white/80 backdrop-blur border-b">
    <div class="mx-auto max-w-7xl px-4 py-3 flex items-center justify-between">
      <a href="/" class="font-semibold">‚Üê Kembali</a>
      <h1 class="text-xl font-semibold">AI Text Formatter</h1>
      <a href="/" class="px-3 py-1.5 rounded-lg bg-indigo-600 text-white text-sm">Dasbor</a>
    </div>
  </header>

  <main class="mx-auto max-w-7xl px-4 py-8 grid grid-cols-12 gap-6">
    <!-- Left column: tools -->
    <section class="col-span-12 lg:col-span-7 space-y-6">
      <!-- 1. Tiru Format -->
      <div class="bg-white rounded-2xl shadow-sm border">
        <div class="px-5 py-4 border-b flex items-center justify-between">
          <h2 class="text-lg font-semibold">1. Format Berdasarkan Contoh</h2>
        </div>
        <div class="p-5 grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-600 mb-1">Tempel Teks Contoh (dengan format)</label>
            <textarea id="ex-text" class="w-full h-44 resize-y rounded-xl border-gray-300 shadow-sm focus:ring-2 focus:ring-indigo-500"></textarea>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-600 mb-1">Tempel Teks Baru (tanpa format)</label>
            <textarea id="new-text" class="w-full h-44 resize-y rounded-xl border-gray-300 shadow-sm focus:ring-2 focus:ring-indigo-500"></textarea>
          </div>
        </div>
        <div class="px-5 pb-5">
          <button id="btn-mimic" class="inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-indigo-600 text-white font-medium hover:bg-indigo-700">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path d="M12 6v6h6"/><path d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
            Tiru Format
          </button>
          <span id="mimic-msg" class="ml-3 text-sm text-rose-600"></span>
        </div>
      </div>

      <!-- 2. Format Cerdas & Ringkas -->
      <div class="bg-white rounded-2xl shadow-sm border">
        <div class="px-5 py-4 border-b">
          <h2 class="text-lg font-semibold">2. Format Cerdas & Ringkas</h2>
          <p class="text-sm text-gray-500">Biarkan AI bekerja pada isi editor utama di bawah. Klik salah satu fungsi.</p>
        </div>
        <div class="p-5 flex flex-wrap gap-3">
          <button id="btn-format" class="inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-emerald-600 text-white font-medium hover:bg-emerald-700">
            <span>üß†</span> Format Cerdas
          </button>
          <button id="btn-summary" class="inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-amber-500 text-white font-medium hover:bg-amber-600">
            <span>‚úÇÔ∏è</span> Ringkas Teks
          </button>
          <span id="smart-msg" class="text-sm text-rose-600"></span>
        </div>
      </div>

      <!-- Editor utama -->
      <div class="bg-white rounded-2xl shadow-sm border">
        <div class="px-5 py-4 border-b flex items-center justify-between">
          <h3 class="text-lg font-semibold">Editor Utama & Hasil</h3>
          <div class="flex gap-2">
            <button id="btn-bold" class="px-2.5 py-1.5 rounded-lg border">B</button>
            <button id="btn-italic" class="px-2.5 py-1.5 rounded-lg border">I</button>
            <button id="btn-mono" class="px-2.5 py-1.5 rounded-lg border text-xs">Monospace</button>
          </div>
        </div>
        <div class="p-5">
          <textarea id="editor" class="w-full h-80 resize-y rounded-xl border-gray-300 shadow-sm focus:ring-2 focus:ring-indigo-500"></textarea>
          <div class="mt-4 flex flex-wrap gap-3">
            <button id="btn-copy" class="px-4 py-2 rounded-xl bg-gray-900 text-white">Salin Hasil</button>
            <button id="btn-clear" class="px-4 py-2 rounded-xl bg-rose-600 text-white">Bersihkan Semua</button>
            <span id="editor-msg" class="text-sm text-rose-600"></span>
          </div>
        </div>
      </div>
    </section>

    <!-- Right column: WhatsApp preview -->
    <aside class="col-span-12 lg:col-span-5">
      <div class="lg:sticky lg:top-20 bg-white rounded-2xl shadow-sm border overflow-hidden">
        <div class="px-5 py-4 border-b flex items-center justify-between">
          <h3 class="text-lg font-semibold">Pratinjau WhatsApp</h3>
          <span class="text-xs text-gray-500">simulasi</span>
        </div>
        <div class="p-0">
          <div class="mx-auto max-w-sm border-x bg-[#0b141a]">
            <!-- WA header -->
            <div class="h-12 bg-[#202c33] text-white flex items-center gap-3 px-3">
              <div class="w-8 h-8 rounded-full bg-[#00a884] flex items-center justify-center font-semibold">MI</div>
              <div class="flex-1">
                <div class="text-sm leading-4">MediaDash</div>
                <div class="text-[11px] text-emerald-400">online</div>
              </div>
            </div>
            <!-- WA chat area -->
            <div class="bg-[url('https://i.imgur.com/8w3t8xU.png')] bg-repeat p-3 min-h-[520px]">
              <div class="max-w-[85%] ml-auto bg-[#e1ffc7] text-[#111b21] rounded-2xl rounded-tr-sm shadow px-3 py-2">
                <div id="wa-bubble" class="whitespace-pre-wrap text-[15px] leading-6">Tampilan teks Anda akan muncul di sini‚Ä¶</div>
                <div class="mt-1 text-[11px] text-right text-gray-500">10:58 PM ‚úì‚úì</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </aside>
  </main>

  <script>
    const FN_URL = '/.netlify/functions/call-gemini';

    const exText = document.getElementById('ex-text');
    const newText = document.getElementById('new-text');
    const editor = document.getElementById('editor');
    const waBubble = document.getElementById('wa-bubble');

    const btnMimic = document.getElementById('btn-mimic');
    const btnFormat = document.getElementById('btn-format');
    const btnSummary = document.getElementById('btn-summary');

    const msgMimic = document.getElementById('mimic-msg');
    const msgSmart = document.getElementById('smart-msg');
    const msgEditor = document.getElementById('editor-msg');

    function setBusy(btn, busy){
      btn.disabled = busy;
      btn.classList.toggle('opacity-60', busy);
    }
    function showBubble(){ waBubble.textContent = editor.value || ' '; }
    editor.addEventListener('input', showBubble);

    async function callAI(payload, btn, msgEl){
      try{
        msgEl.textContent = '';
        setBusy(btn, true);
        const res = await fetch(FN_URL, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
        const data = await res.json();
        if(!res.ok || !data.ok){ throw new Error(data.error || ('HTTP ' + res.status)); }
        return data.text || '';
      }catch(e){ msgEl.textContent = e.message; return null; }
      finally{ setBusy(btn, false); }
    }

    btnMimic.addEventListener('click', async ()=>{
      const t = await callAI({ action: 'mimic', exampleText: exText.value.trim(), newText: newText.value.trim() }, btnMimic, msgMimic);
      if(t!=null){ editor.value = t; showBubble(); }
    });
    btnFormat.addEventListener('click', async ()=>{
      const t = await callAI({ action: 'format', editorText: editor.value.trim() }, btnFormat, msgSmart);
      if(t!=null){ editor.value = t; showBubble(); }
    });
    btnSummary.addEventListener('click', async ()=>{
      const t = await callAI({ action: 'summarize', editorText: editor.value.trim() }, btnSummary, msgSmart);
      if(t!=null){ editor.value = t; showBubble(); }
    });

    document.getElementById('btn-copy').addEventListener('click', async ()=>{
      await navigator.clipboard.writeText(editor.value||'');
      msgEditor.textContent = 'Disalin.';
      setTimeout(()=> msgEditor.textContent='', 1600);
    });
    document.getElementById('btn-clear').addEventListener('click', ()=>{ exText.value=''; newText.value=''; editor.value=''; showBubble(); });

    // simple format helpers
    function wrapSelection(before, after){
      const ta = editor; const start = ta.selectionStart; const end = ta.selectionEnd; const v = ta.value;
      ta.value = v.slice(0,start) + before + v.slice(start,end) + (after ?? before) + v.slice(end);
      ta.focus(); ta.selectionStart = start + before.length; ta.selectionEnd = end + before.length; showBubble();
    }
    document.getElementById('btn-bold').addEventListener('click', ()=>wrapSelection('**','**'));
    document.getElementById('btn-italic').addEventListener('click', ()=>wrapSelection('_','_'));
    document.getElementById('btn-mono').addEventListener('click', ()=>wrapSelection('`','`'));

    showBubble();
  </script>
</body>
</html>


<!-- =============================================
FILE: netlify/functions/call-gemini.js
Place this file under netlify/functions/ in your repo.
Environment: set GOOGLE_API_KEY (or GEMINI_API_KEY) in Netlify Env Vars.
============================================= -->
<script type="text/plain" data-filename="netlify/functions/call-gemini.js">import { Buffer } from 'node:buffer';

const cors = () => ({
  'Access-Control-Allow-Origin': '*',
  'Access-Control-Allow-Headers': 'Content-Type'
});
const bad = (m) => ({ statusCode: 400, headers: cors(), body: JSON.stringify({ ok: false, error: m }) });

export async function handler(event) {
  if (event.httpMethod === 'OPTIONS') {
    return { statusCode: 204, headers: cors() };
  }
  try {
    const body = JSON.parse(event.body || '{}');
    const action = body.action;
    const exampleText = (body.exampleText || '').trim();
    const newText = (body.newText || '').trim();
    const editorText = (body.editorText || '').trim();

    let prompt = '';
    if (action === 'mimic') {
      if (!exampleText || !newText) return bad('exampleText and newText required');
      prompt = `Tugas Anda: tiru format dan gaya dari TEKS CONTOH (heading, penomoran, bullets, jarak baris) dan terapkan pada TEKS BARU. Jangan menambah konten baru. Hanya ubah struktur/format agar rapi, gunakan bahasa Indonesia yang baik.

TEKS CONTOH:\n${exampleText}\n\n---\nTEKS BARU:\n${newText}\n\n---\nKELUARAN (hanya teks terformat):`;
    } else if (action === 'format') {
      if (!editorText) return bad('editorText required');
      prompt = `Rapikan teks berikut menjadi dokumen rapi: gunakan heading yang wajar, bullet/nomor bila perlu, perataan baris konsisten, ejaan BI, tanpa menambah fakta baru. Hasilkan teks final.

TEKS:\n${editorText}\n\n---\nKELUARAN:`;
    } else if (action === 'summarize') {
      if (!editorText) return bad('editorText required');
      prompt = `Ringkas teks berikut menjadi poin-poin WhatsApp singkat (maks 8 poin, tiap poin satu baris, tetap akurat, tidak ada tambahan baru).

TEKS:\n${editorText}\n\n---\nRINGKASAN:`;
    } else {
      return bad('Unknown action');
    }

    const apiKey = process.env.GOOGLE_API_KEY || process.env.GEMINI_API_KEY;
    if (!apiKey) return { statusCode: 500, headers: cors(), body: JSON.stringify({ ok: false, error: 'MISSING_API_KEY' }) };

    const payload = {
      contents: [{ role: 'user', parts: [{ text: prompt }] }],
      generationConfig: { temperature: 0.25, topP: 0.95, maxOutputTokens: 2048 }
    };

    const url = `https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=${apiKey}`;
    const resp = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
    const json = await resp.json();
    if (!resp.ok) {
      return { statusCode: resp.status, headers: cors(), body: JSON.stringify({ ok: false, error: json?.error?.message || 'GENERATION_FAILED', raw: json }) };
    }
    const text = json.candidates?.[0]?.content?.parts?.map(p => p.text).join('') || '';
    return { statusCode: 200, headers: cors(), body: JSON.stringify({ ok: true, text }) };
  } catch (e) {
    return { statusCode: 500, headers: cors(), body: JSON.stringify({ ok: false, error: e.message }) };
  }
}
</script>
