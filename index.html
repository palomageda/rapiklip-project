<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MediaDash</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial}
    .hidden{display:none}
    .modal-overlay{position:fixed;inset:0;background:rgba(17,24,39,.6);display:flex;align-items:center;justify-content:center;opacity:0;visibility:hidden;transition:.25s}
    .modal-overlay.visible{opacity:1;visibility:visible}
    .modal-content{background:#fff;border-radius:12px;max-width:420px;width:92%;padding:20px}
    .tab-button{padding:.75rem .5rem;border-bottom:2px solid transparent}
    .tab-button.active{border-color:#4f46e5;color:#4f46e5;font-weight:600}
  </style>
</head>
<body class="bg-gray-50 text-gray-800">
  <header class="bg-white border-b">
    <nav class="max-w-7xl mx-auto h-16 px-4 flex items-center justify-between">
      <h1 class="font-bold">MediaDash ✨</h1>
      <div class="flex items-center gap-2">
        <span id="user-email" class="text-sm text-gray-600 hidden"></span>
        <button id="settings-btn" class="p-2 rounded hover:bg-gray-100">⚙️</button>
      </div>
    </nav>
  </header>

  <main class="px-4 py-8 max-w-7xl mx-auto">
    <div class="mb-6 border-b border-gray-200">
      <nav class="-mb-px flex gap-6" aria-label="Tabs">
        <button id="tab-formatter" class="tab-button active" type="button">Formatter Teks</button>
        <button id="tab-scheduler" class="tab-button" type="button">Buat Postingan</button>
      </nav>
    </div>

    <section id="formatter-content">
      <div class="bg-white p-6 rounded-xl shadow">
        <h2 class="text-2xl font-bold mb-2">AI Text Formatter</h2>
        <p class="text-gray-600">Konten formatter kamu di sini.</p>
      </div>
    </section>

    <section id="scheduler-content" class="hidden">
      <div class="bg-white p-6 rounded-xl shadow">
        <h2 class="text-2xl font-bold mb-6">Buat & Jadwalkan Postingan</h2>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <div class="lg:col-span-2">
            <label class="block text-sm font-medium text-gray-700 mb-1">Tulis caption</label>
            <textarea id="caption" rows="8" class="w-full p-3 border rounded-md"></textarea>
          </div>
          <div>
            <div class="p-4 bg-gray-50 rounded-lg border">
              <div class="flex items-center justify-between mb-2">
                <span class="text-sm font-medium text-gray-700">Pilih Platform</span>
                <button id="connect-account-btn" type="button" class="text-xs text-indigo-600 font-semibold hover:underline">Hubungkan Akun</button>
              </div>
              <label class="flex items-center gap-2">
                <input id="platform-x" type="checkbox" class="h-4 w-4 text-indigo-600 rounded">
                <span>X (Twitter)</span>
              </label>
            </div>
            <div class="mt-3 flex flex-col gap-3">
              <button id="schedule-post-btn" class="w-full px-4 py-3 bg-indigo-600 text-white rounded-lg font-semibold">Jadwalkan</button>
              <button id="post-now-btn" class="w-full px-4 py-2 bg-gray-700 text-white rounded-lg font-semibold">Posting Sekarang</button>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Modal Pengaturan -->
  <div id="settings-modal" class="modal-overlay" aria-hidden="true" role="dialog">
    <div class="modal-content">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-semibold">Pengaturan Akun</h3>
        <button id="close-settings-btn" class="text-gray-500 hover:text-gray-700">✕</button>
      </div>
      <h4 class="font-medium mb-2">Hubungkan Akun Media Sosial</h4>
      <p class="text-sm text-gray-600 mb-4">Kami tidak pernah menyimpan password Anda.</p>
      <button id="connect-twitter-btn" class="w-full flex items-center justify-center gap-2 px-4 py-2.5 border rounded-lg bg-white hover:bg-gray-50">
        <span>Hubungkan Akun X (Twitter)</span>
      </button>
    </div>
  </div>

  <!-- Status Modal -->
  <div id="status-modal" class="modal-overlay"><div id="status-modal-content" class="modal-content"></div></div>

  <script type="module">
    // Tab
    const tabFormatter = document.getElementById('tab-formatter');
    const tabScheduler = document.getElementById('tab-scheduler');
    const formatterContent = document.getElementById('formatter-content');
    const schedulerContent = document.getElementById('scheduler-content');
    const setTab = (name) => {
      tabFormatter.classList.toggle('active', name==='formatter');
      tabScheduler.classList.toggle('active', name==='scheduler');
      formatterContent.classList.toggle('hidden', name!=='formatter');
      schedulerContent.classList.toggle('hidden', name!=='scheduler');
    };
    tabFormatter.addEventListener('click', ()=>setTab('formatter'));
    tabScheduler.addEventListener('click', ()=>setTab('scheduler'));

    // Modal util
    const settingsModal = document.getElementById('settings-modal');
    const statusModal = document.getElementById('status-modal');
    const statusModalContent = document.getElementById('status-modal-content');
    const toggleModal = (modal, show, html='', isErr=false) => {
      if(show){
        if(html) statusModalContent.innerHTML = `<p class="${isErr?'text-red-600':'text-gray-800'}">${html}</p>`;
        modal.classList.add('visible'); modal.classList.remove('hidden');
      } else { modal.classList.remove('visible'); setTimeout(()=>modal.classList.add('hidden'), 250); }
    };

    // Open/close settings
    document.getElementById('settings-btn').addEventListener('click', ()=>toggleModal(settingsModal, true));
    document.getElementById('close-settings-btn').addEventListener('click', ()=>toggleModal(settingsModal, false));
    settingsModal.addEventListener('click', (e)=>{ if(e.target===settingsModal) toggleModal(settingsModal,false); });

    // ====== INI BAGIAN PENTINGNYA ======
    // 1) Tombol di modal
    const connectTwitterBtn = document.getElementById('connect-twitter-btn');
    if (connectTwitterBtn) {
      connectTwitterBtn.addEventListener('click', () => {
        window.location.href = '/.netlify/functions/oauth-x-start';
      });
    }
    // 2) Tombol “Hubungkan Akun” di panel kanan scheduler
    const connectAccountBtn = document.getElementById('connect-account-btn');
    if (connectAccountBtn) {
      connectAccountBtn.addEventListener('click', () => {
        // buka modal dulu supaya konsisten UX
        toggleModal(settingsModal, true);
      });
    }
    // ===================================

    // Optional: helper notifikasi
    function toast(msg, isErr=false){
      toggleModal(statusModal, true, msg, isErr);
      setTimeout(()=>toggleModal(statusModal,false), 1500);
    }
  </script>
</body>
</html>
